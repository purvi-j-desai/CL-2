/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include "db.h"
#include <stdio.h> 
#define FILENAME "maindb.txt"
#define REPLACEF "backupdb.txt"
int *
insert_4_svc(struct rec *argp, struct svc_req *rqstp)
{
	static int  result;
	FILE *fp;
	fp = fopen(FILENAME, "a");
	result = fwrite((char *)argp, sizeof(struct rec), 1, fp);
	fclose(fp);
	return &result;
}

int *
delete_4_svc(struct rec *argp, struct svc_req *rqstp)
{
	static int  result;
	

	return &result;
}

int *
update_4_svc(struct rec *argp, struct svc_req *rqstp)
{
	static int  result;

	printf("We are connected in update...\n");

	return &result;
}

struct rec *
show_4_svc(int *argp, struct svc_req *rqstp)
{
	static struct rec  result;
	/*FILE *fp;
	fp = fopen(FILENAME, "r");
	while(fread((char *)&result, sizeof(result), 1, fp)) {
	  if(result.rno == *argp)
	    break;
	}
	fclose(fp);
	if(result.rno != *argp) {result.rno = -1;}
        */
	struct rec res;
	printf("We are connected in delete...\n");
	FILE *fp, *fp1;
	fp = fopen(FILENAME, "r");
	fp1 = fopen(REPLACEF, "w");
	while(fread((char *)&res, sizeof(res), 1, fp)) {
	  if(res.rno != *argp)
	    fwrite((char *)&res, sizeof(res), 1, fp1));
	}
	fclose(fp);
	fclose(fp1);
	return &result;
}
